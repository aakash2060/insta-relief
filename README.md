# InstaRelief

InstaRelief is a prototype micro‑insurance and emergency relief demo that automatically detects NOAA weather alerts, pre-credits impacted users, and lets administrators execute vetted Solana (SOL) payouts via Phantom. It pairs Firebase (Auth / Firestore / Cloud Functions) with a small AI admin assistant and Solana devnet payouts to demonstrate fast, auditable disaster relief workflows.

This repository is intended for demos, rapid prototyping, and experimentation — not for production use without proper security, audits and approvals.
**Quick Links**
- **App entry**: `src/App.tsx`
- **Firebase exports**: `src/firebase.ts` (exports `auth`, `db`, and `functions` helpers)
- **User dashboard**: `src/pages/Dashboard.tsx`
- **Admin UI & AI assistant**: `src/pages/AdminDashboard.tsx`, `src/components/AIAssistant.tsx`
- **Solana helpers**: `src/lib/solana.ts` (contains `getProvider`, `sendSol`)
- **Price conversion**: `src/lib/priceService.ts` (contains `convertUSDtoSOL`)
- **NOAA map UI**: `src/components/NoaaMap.tsx`
- **Cloud Functions & agent**: `functions/index.js`, `functions/agent/agent.js`, `functions/agent/handlers.js`
- **Helper scripts**: `scripts/setAdmin.cjs`, `seedUser.js`, `disasterCall.js`
**Core Features**
- **NOAA Alerts**: Cloud Function polls/ingests NOAA alerts and flags affected users.
- **Pre-crediting**: Automatically credit affected user balances in Firestore for demonstration payouts.
- **Admin review & payouts**: Admin UI to review events, use the AI assistant to prepare actions, and trigger Solana devnet payouts via Phantom.
- **On-chain demo payouts**: `sendSol` + wallet connection logic demonstrate SOL transfers (devnet).
- **User flows**: onboarding, login, dashboard with balance and withdrawal flows.
**Local Development (Frontend)**
1. Copy environment variables: create a `.env` in the repo root (refer to the existing `.env` for keys used).
2. Install and run the frontend:

```powershell
npm install
npm run dev
```

3. App entry: `src/App.tsx` (Vite + React + MUI stack).
**Cloud Functions (local / emulator)**

The `functions/` folder implements NOAA ingestion, balance updates, and an AI agent. To test locally:

```powershell
cd functions
npm install
firebase emulators:start --only functions,firestore,auth
```

Use `disasterCall.js` (root) or the callable functions in `functions/index.js` to simulate incoming alerts or test payout flows.
**Seeding & Admin Management**
- Seed demo users for local testing: `seedUser.js` (root) — useful with Firestore emulator.
- Grant admin privileges with the service-account helper: `scripts/setAdmin.cjs`.
**Implementation Notes**
- **USD → SOL conversion**: Implemented in `src/lib/priceService.ts` (caching and rate lookup helpers).
- **Wallet & transfers**: `src/lib/solana.ts` contains `getProvider` and `sendSol` which rely on Phantom wallet connection.
- **AI agent**: `functions/agent/` holds the agent logic used by the admin assistant to suggest actions and orchestrate tasks.
- **Policy IDs**: Generated by `utils/generatePolicyId.ts`.
**Security & Operational Cautions**

This repository is a demo/prototype. Do NOT use this code in production without significant modifications and operational controls:

- **Secrets**: Keep API keys and service account credentials out of source control and use a secrets manager.
- **Approval flows**: Add human-in-the-loop approval for any real monetary transactions.
- **Rate limiting & fraud controls**: Add checks before automated credits/payouts.
- **Audit logs**: Persist comprehensive audit trails for all balance and payout changes.
- **AI safety**: The agent can act programmatically; restrict and monitor agent capabilities in real environments.
**Troubleshooting**
- **Phantom/Wallet issues**: Ensure Phantom extension is enabled and set to devnet when running demo payouts.
- **Firestore emulator**: Start `firebase emulators:start` and confirm frontend is configured to use emulator endpoints when testing locally.
- **Missing env vars**: Cloud Functions and the frontend require API keys and service credentials; verify `functions/.env` and the repo root `.env`.
**Helpful Files (Quick Reference)**
- **Frontend entry**: `src/App.tsx`, `src/main.tsx`
- **Pages**: `src/pages/Onboarding.tsx`, `src/pages/Login.tsx`, `src/pages/Dashboard.tsx`, `src/pages/AdminLogin.tsx`, `src/pages/AdminDashboard.tsx`
- **Components**: `src/components/NoaaMap.tsx`, `src/components/AIAssistant.tsx`, `src/components/AdminWalletConnect.tsx`
- **Libs**: `src/lib/solana.ts`, `src/lib/priceService.ts`
- **Functions**: `functions/index.js`, `functions/agent/agent.js`, `functions/agent/handlers.js`
- **Scripts**: `seedUser.js`, `scripts/setAdmin.cjs`, `disasterCall.js`
**License & Notes**
This repository contains demo/proof-of-concept code (hackathon/demo). Verify licensing and remove any test credentials before sharing or deploying. The project is provided "as-is" for experimentation.



